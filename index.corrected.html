<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShopMate — E‑commerce Starter</title>
  <meta name="description" content="A complete e‑commerce starter in vanilla HTML/CSS/JS with catalog, filters, cart, checkout, auth, profile, and admin panel." />
  <style>
    :root {
      --bg: #0a0e17;
      --bg-gradient: linear-gradient(135deg, #0a0e17 0%, #1a1f2e 100%);
      --card: #141824;
      --card-hover: #1a1f30;
      --muted: #94a3b8;
      --text: #f1f5f9;
      --brand: #3b82f6;
      --brand-2: #10b981;
      --brand-hover: #2563eb;
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      --border: #1e293b;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
      --radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    html,body{margin:0; padding:0; background:var(--bg); background-image:var(--bg-gradient); color:var(--text); font:16px/1.6 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif; overflow-x:hidden}
    a{color:inherit; text-decoration:none; transition:var(--transition)}
    a:hover{color:var(--brand)}
    img{max-width:100%; display:block; transition:var(--transition)}
    .container{max-width:1280px; margin:0 auto; padding:0 24px}
    .grid{display:grid; gap:20px}
    .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; background:var(--brand); color:#fff; border:none; padding:12px 24px; border-radius:var(--radius); cursor:pointer; box-shadow:var(--shadow); transition:var(--transition); font-weight:600; font-size:15px; position:relative; overflow:hidden}
    .btn::before{content:''; position:absolute; top:50%; left:50%; width:0; height:0; border-radius:50%; background:rgba(255,255,255,0.3); transform:translate(-50%,-50%); transition:width 0.6s, height 0.6s}
    .btn:hover{transform:translateY(-2px); box-shadow:var(--shadow-lg); background:var(--brand-hover)}
    .btn:hover::before{width:300px; height:300px}
    .btn:active{transform:translateY(0)}
    .btn.secondary{background:#334155}
    .btn.secondary:hover{background:#475569}
    .btn.ghost{background:transparent; border:1px solid var(--border)}
    .btn.ghost:hover{background:rgba(59,130,246,0.1); border-color:var(--brand)}
    .btn.danger{background:var(--danger)}
    .btn.danger:hover{background:#dc2626}
    .tag{padding:.35rem .75rem; border-radius:999px; background:rgba(59,130,246,0.15); color:var(--brand); font-size:.8rem; font-weight:600; border:1px solid rgba(59,130,246,0.3)}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); transition:var(--transition); backdrop-filter:blur(10px)}
    .card:hover{transform:translateY(-4px); box-shadow:var(--shadow-lg); border-color:rgba(59,130,246,0.3)}
    .hidden{display:none !important}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    /* Header */
    .topbar{background:rgba(20,24,36,0.8); backdrop-filter:blur(12px); border-bottom:1px solid var(--border); position:relative; overflow:hidden}
    .topbar::before{content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg, transparent, rgba(59,130,246,0.1), transparent); animation:shimmer 3s infinite}
    @keyframes shimmer{to{left:100%}}
    .topbar .inner{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 0; font-size:.9rem; color:var(--muted)}
    .promo{color:var(--brand); font-weight:500; display:flex; align-items:center; gap:8px}
    .promo::before{content:'✨'; animation:pulse 2s infinite}

    header.nav{position:sticky; top:0; z-index:40; background:rgba(10,14,23,0.9); backdrop-filter:saturate(140%) blur(16px); border-bottom:1px solid var(--border); box-shadow:0 4px 20px rgba(0,0,0,0.3)}
    .nav-inner{display:flex; align-items:center; gap:16px; padding:16px 0}
    .brand{display:flex; align-items:center; gap:12px; font-weight:800; font-size:1.25rem; cursor:pointer; transition:var(--transition)}
    .brand:hover{transform:scale(1.05)}
    .brand .logo{width:40px; height:40px; border-radius:10px; background:linear-gradient(135deg,var(--brand),var(--brand-2)); box-shadow:var(--shadow-lg); transition:var(--transition)}
    .brand .logo:hover{transform:rotate(5deg)}
    .nav-search{flex:1; display:flex; gap:10px; max-width:600px}
    .nav-search input{flex:1; padding:12px 16px; border-radius:var(--radius); border:1px solid var(--border); background:var(--card); color:var(--text); transition:var(--transition); font-size:15px}
    .nav-search input:focus{outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(59,130,246,0.2)}
    .nav-actions{display:flex; align-items:center; gap:10px}
    .icon-btn{background:var(--card); border:1px solid var(--border); padding:10px 14px; border-radius:var(--radius); cursor:pointer; transition:var(--transition); display:flex; align-items:center; gap:6px; font-size:1.1rem}
    .icon-btn:hover{background:var(--card-hover); transform:translateY(-2px); border-color:var(--brand)}

    /* Hero */
    .hero{position:relative; padding:48px 0 32px}
    .hero-wrap{display:grid; grid-template-columns:1.2fr .8fr; gap:32px; align-items:center}
    .hero-card{padding:40px; border-radius:16px; background:linear-gradient(135deg, rgba(20,24,36,0.8) 0%, rgba(30,41,59,0.6) 100%); border:1px solid var(--border); position:relative; overflow:hidden}
    .hero-card::before{content:''; position:absolute; top:-50%; right:-50%; width:200%; height:200%; background:radial-gradient(circle, rgba(59,130,246,0.1) 0%, transparent 70%); animation:rotate 20s linear infinite}
    @keyframes rotate{to{transform:rotate(360deg)}}
    .hero h1{font-size:clamp(32px,5vw,56px); line-height:1.15; margin:0 0 16px; background:linear-gradient(135deg, #f1f5f9 0%, var(--brand) 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; font-weight:900}
    .hero p{color:var(--muted); font-size:1.125rem; line-height:1.7; margin:0 0 24px}
    .carousel{position:relative; border-radius:16px; overflow:hidden; min-height:320px; box-shadow:var(--shadow-lg)}
    .carousel img{width:100%; height:100%; object-fit:cover; transition:transform 0.5s ease}
    .carousel:hover img{transform:scale(1.05)}
    .carousel .dots{position:absolute; bottom:16px; left:50%; transform:translateX(-50%); display:flex; gap:10px; background:rgba(0,0,0,0.5); padding:8px 16px; border-radius:999px; backdrop-filter:blur(8px)}
    .dot{width:10px; height:10px; border-radius:50%; background:rgba(255,255,255,0.5); border:none; opacity:.6; cursor:pointer; transition:var(--transition)}
    .dot:hover{opacity:1; transform:scale(1.2)}
    .dot.active{background:#fff; opacity:1; width:28px; border-radius:999px}

    /* Categories */
    .categories{padding:16px 0 32px}
    .cat-grid{grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:16px}
    .cat{padding:18px 16px; display:flex; align-items:center; gap:12px; border:1px solid var(--border); border-radius:var(--radius); background:var(--card); cursor:pointer; transition:var(--transition); font-weight:600; position:relative; overflow:hidden}
    .cat::before{content:''; position:absolute; inset:0; background:linear-gradient(135deg, transparent, rgba(59,130,246,0.1)); opacity:0; transition:var(--transition)}
    .cat:hover{transform:translateY(-4px); box-shadow:var(--shadow-lg); border-color:var(--brand)}
    .cat:hover::before{opacity:1}
    .cat span{position:relative; z-index:1}

    /* Catalog */
    .section{padding:40px 0}
    .section h2{margin:0 0 20px; font-size:2rem; font-weight:800}
    .catalog{grid-template-columns:280px 1fr; align-items:start; gap:32px}
    .filters{position:sticky; top:100px; padding:24px; border:1px solid var(--border); border-radius:var(--radius); background:var(--card)}
    .filters h3{margin:0 0 16px; font-size:1.125rem; font-weight:700}
    .filters .group{margin-bottom:20px}
    .filters label{cursor:pointer; display:flex; align-items:center; gap:8px; padding:4px 0; transition:var(--transition)}
    .filters label:hover{color:var(--brand)}
    .range{width:100%}
    .product-grid{grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:24px}
    .product{display:flex; flex-direction:column; height:100%}
    .product .thumb{aspect-ratio:4/3; background:var(--bg); border-bottom:1px solid var(--border); border-radius:var(--radius) var(--radius) 0 0; overflow:hidden; position:relative}
    .product .thumb::after{content:''; position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,0.4), transparent); opacity:0; transition:var(--transition)}
    .product:hover .thumb::after{opacity:1}
    .product .thumb img{width:100%; height:100%; object-fit:cover}
    .product:hover .thumb img{transform:scale(1.08)}
    .product .meta{padding:18px; display:grid; gap:10px; flex:1}
    .price{display:flex; align-items:center; gap:10px; font-size:1.125rem}
    .price strong{color:var(--brand); font-size:1.25rem}
    .price del{color:#64748b; font-size:.95rem}
    .stars{font-size:.95rem; color:#fbbf24}
    .controls{display:flex; gap:10px; margin-top:auto}

    /* Product modal */
    .overlay{position:fixed; inset:0; background:rgba(0,0,0,.65); backdrop-filter:blur(8px); display:none; place-items:center; z-index:100; animation:fadeIn 0.3s ease}
    @keyframes fadeIn{from{opacity:0} to{opacity:1}}
    .overlay.active{display:grid}
    .modal{width:min(1000px,92vw); max-height:90vh; overflow:auto; background:var(--card); border:1px solid var(--border); border-radius:20px; box-shadow:var(--shadow-lg); animation:slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1)}
    @keyframes slideUp{from{opacity:0; transform:translateY(40px)} to{opacity:1; transform:translateY(0)}}
    .modal .body{display:grid; grid-template-columns:1fr 1fr; gap:24px; padding:24px}
    .modal header{display:flex; align-items:center; justify-content:space-between; padding:20px 24px; border-bottom:1px solid var(--border); background:rgba(59,130,246,0.05)}
    .modal header strong{font-size:1.25rem}

    /* Cart */
    .cart{position:fixed; right:24px; bottom:24px; z-index:50}
    .cart #btnCartFloat{box-shadow:var(--shadow-lg); animation:bounce 2s infinite}
    @keyframes bounce{0%, 100%{transform:translateY(0)} 50%{transform:translateY(-8px)}}
    .cart-panel{position:fixed; right:0; top:0; height:100%; width:min(480px,100%); background:var(--card); border-left:1px solid var(--border); transform:translateX(100%); transition:transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); display:flex; flex-direction:column; box-shadow:-10px 0 40px rgba(0,0,0,0.5); z-index:100}
    .cart-panel.active{transform:translateX(0)}
    .cart-head{padding:20px 24px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; background:rgba(59,130,246,0.05)}
    .cart-head strong{font-size:1.25rem}
    .cart-items{flex:1; overflow:auto; display:grid; gap:16px; padding:20px; background:linear-gradient(to bottom, transparent, rgba(0,0,0,0.1))}
    .cart-item{display:grid; grid-template-columns:80px 1fr auto; gap:12px; align-items:center; border:1px solid var(--border); border-radius:var(--radius); padding:12px; background:rgba(20,24,36,0.5); transition:var(--transition)}
    .cart-item:hover{background:var(--card-hover); border-color:var(--brand)}
    .cart-item img{border-radius:8px}
    .qty{display:flex; align-items:center; gap:8px}
    .cart-foot{padding:20px 24px; border-top:1px solid var(--border); display:grid; gap:16px; background:rgba(0,0,0,0.2)}

    /* Checkout */
    .checkout{padding:40px 0}
    .checkout-grid{grid-template-columns:1.1fr .9fr; gap:32px}
    form .field{display:grid; gap:8px; margin-bottom:16px}
    form .field label{font-weight:600; color:var(--muted); font-size:0.9rem}
    input, select, textarea{background:var(--card); border:1px solid var(--border); color:var(--text); border-radius:var(--radius); padding:12px 16px; transition:var(--transition); font-size:15px}
    input:focus, select:focus, textarea:focus{outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(59,130,246,0.2); background:var(--card-hover)}

    /* Auth */
    .auth-grid{display:grid; grid-template-columns:1fr 1fr; gap:32px}
    .auth-grid form{padding:16px}

    /* Profile/Orders */
    .tabs{display:flex; gap:8px; border-bottom:2px solid var(--border); margin-bottom:20px}
    .tab{padding:12px 20px; border-radius:var(--radius) var(--radius) 0 0; border:1px solid transparent; cursor:pointer; transition:var(--transition); font-weight:600; position:relative}
    .tab:hover{background:rgba(59,130,246,0.1)}
    .tab.active{border-color:var(--border); border-bottom-color:transparent; background:var(--card); color:var(--brand)}
    .tab.active::after{content:''; position:absolute; bottom:-2px; left:0; right:0; height:2px; background:var(--brand)}

    /* Admin */
    table{width:100%; border-collapse:collapse}
    th{background:rgba(59,130,246,0.1); font-weight:700; padding:14px; text-align:left; border-bottom:2px solid var(--border)}
    td{border-bottom:1px solid var(--border); padding:12px; text-align:left}
    tbody tr{transition:var(--transition)}
    tbody tr:hover{background:rgba(59,130,246,0.08); transform:scale(1.01)}

    /* Footer */
    footer{border-top:1px solid var(--border); padding:48px 0 32px; color:var(--muted); background:rgba(0,0,0,0.2); margin-top:64px}
    footer a{transition:var(--transition); display:block; padding:4px 0}
    footer a:hover{color:var(--brand); transform:translateX(4px)}
    footer strong{color:var(--text); font-size:1.1rem; margin-bottom:12px; display:block}

    /* Responsive */
    @media (max-width: 1024px){
      .hero-wrap{grid-template-columns:1fr}
      .hero-card{padding:32px 24px}
      .catalog{grid-template-columns:1fr}
      .filters{position:static; margin-bottom:24px}
      .product-grid{grid-template-columns:repeat(auto-fill, minmax(240px, 1fr))}
      .cat-grid{grid-template-columns:repeat(auto-fit, minmax(120px, 1fr))}
      .modal .body{grid-template-columns:1fr}
      .checkout-grid{grid-template-columns:1fr}
      .auth-grid{grid-template-columns:1fr}
      footer .grid{grid-template-columns:1fr !important}
    }
    @media (max-width: 768px){
      .container{padding:0 16px}
      .nav-inner{gap:12px}
      .brand{font-size:1.1rem}
      .nav-search{max-width:none}
      .topbar .inner{flex-direction:column; gap:8px; text-align:center}
      .section{padding:24px 0}
    }
    @media (max-width: 560px){
      .product-grid{grid-template-columns:1fr}
      .cat-grid{grid-template-columns:repeat(2,1fr)}
      .hero h1{font-size:28px}
      .hero-card{padding:24px}
      .modal{width:96vw; max-height:94vh}
      .cart-panel{width:100%}
    }
  
    /* --- Enhancements --- */
    [data-theme="light"]{
      --bg: #f8fafc;
      --bg-gradient: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      --card: #ffffff;
      --card-hover: #f1f5f9;
      --muted: #64748b;
      --text: #0f172a;
      --brand: #2563eb;
      --brand-2: #10b981;
      --brand-hover: #1d4ed8;
      --danger: #ef4444;
      --warning: #f59e0b;
      --success: #10b981;
      --border: #e2e8f0;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .brand .logo{width:34px; height:34px; object-fit:cover; border-radius:9px; box-shadow:var(--shadow)}
    .icon-btn.wish{display:inline-flex; align-items:center; justify-content:center; width:40px; height:40px}
    .icon-btn.wish.active{background:#2b2e3a; border-color:#4b5563}
    .icon-btn.wish.active::after{content:'♥';}
    .icon-btn.wish::after{content:'♡';}
    .btn:focus, .icon-btn:focus, input:focus, select:focus, textarea:focus{outline:2px solid color-mix(in oklab, var(--brand) 60%, transparent); outline-offset:2px}
    .toast{position:fixed; left:50%; top:18px; transform:translateX(-50%); background:var(--card); color:var(--text); border:1px solid var(--border); box-shadow:var(--shadow); padding:10px 14px; border-radius:10px; display:none; z-index:60}
    .toast.show{display:block; animation:fadeout 2.2s both}
    @keyframes fadeout{0%{opacity:0; transform:translate(-50%, -6px)} 12%{opacity:1; transform:translate(-50%,0)} 100%{opacity:0}}
    .review{border:1px solid var(--border); border-radius:12px; padding:10px}
    .stars-input{display:flex; gap:6px}
    .stars-input button{background:transparent; border:0; font-size:20px; cursor:pointer}
    .coupon{display:flex; gap:8px}
    .coupon input{flex:1}

  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="container inner">
      <span class="promo">Free shipping on orders over ₹999 • 30‑day returns</span>
      <div>
        <button class="btn ghost" id="btnSignIn">Sign In</button>
        <button class="btn secondary" id="btnSignUp">Create Account</button>
      </div>
    </div>
  </div>

  <!-- Nav -->
  <header class="nav">
    <div class="container nav-inner">
      <div class="brand"><img class="logo" src="https://i.pinimg.com/736x/54/1e/e2/541ee2dfb9f7665ec330d2ba35801d22.jpg" alt="ShopMate logo"/> ShopMate</div>
      <div class="nav-search">
        <input id="searchInput" type="search" placeholder="Search products… (e.g., headphones)" aria-label="Search products" />
        <button class="btn" id="btnSearch">Search</button>
      </div>
      <div class="nav-actions">
        <button class="icon-btn" id="btnOpenCart" aria-label="Open cart">🛒 <span id="cartCount" class="tag" style="margin-left:6px">0</span></button>
        <button class="icon-btn" id="btnTheme" aria-label="Toggle theme">🌓</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-wrap">
      <div class="hero-card">
        <h1>Discover. Add to Cart. Smile 😄</h1>
        <p>Quality gadgets, apparel, and home essentials at irresistible prices — delivered fast.</p>
        <div style="display:flex; gap:10px; margin-top:12px">
          <a href="#catalog" class="btn">Shop now</a>
          <a href="#categories" class="btn secondary">Browse categories</a>
        </div>
      </div>
      <div class="carousel card" id="heroCarousel" aria-roledescription="carousel" aria-label="Featured banners">
        <img alt="Summer sale banner" src="https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1600&auto=format&fit=crop" />
        <div class="dots" aria-hidden="true"></div>
      </div>
    </div>
  </section>

  <!-- Categories -->
  <section class="categories" id="categories">
    <div class="container">
      <div class="grid cat-grid">
        <div class="cat" data-cat="Audio">🎧 <span>Audio</span></div>
        <div class="cat" data-cat="Laptops">💻 <span>Laptops</span></div>
        <div class="cat" data-cat="Phones">📱 <span>Phones</span></div>
        <div class="cat" data-cat="Wearables">⌚ <span>Wearables</span></div>
        <div class="cat" data-cat="Home">🏠 <span>Home</span></div>
        <div class="cat" data-cat="Fashion">🧥 <span>Fashion</span></div>
        <div class="cat" data-cat="Accessories">🔌 <span>Accessories</span></div>
        <div class="cat" data-cat="Gaming">🎮 <span>Gaming</span></div>
        <div class="cat" data-cat="Furniture">🪑 <span>Furniture</span></div>
        <div class="cat" data-cat="Health">⚕️ <span>Health</span></div>
        <div class="cat" data-cat="Storage">💽 <span>Storage</span></div>
      </div>
    </div>
  </section>

  <!-- Catalog -->
  <section class="section" id="catalog">
    <div class="container grid catalog">
      <!-- Filters -->
      <aside class="filters" aria-label="Product filters">
        <h3>Filters</h3>
        <div class="group">
          <strong>Category</strong>
          <div class="grid" style="grid-template-columns:1fr 1fr">
            <label><input type="checkbox" class="f-cat" value="Audio" checked> Audio</label>
            <label><input type="checkbox" class="f-cat" value="Laptops" checked> Laptops</label>
            <label><input type="checkbox" class="f-cat" value="Phones" checked> Phones</label>
            <label><input type="checkbox" class="f-cat" value="Wearables" checked> Wearables</label>
            <label><input type="checkbox" class="f-cat" value="Home" checked> Home</label>
            <label><input type="checkbox" class="f-cat" value="Fashion" checked> Fashion</label>
            <label><input type="checkbox" class="f-cat" value="Accessories" checked> Accessories</label>
            <label><input type="checkbox" class="f-cat" value="Gaming" checked> Gaming</label>
            <label><input type="checkbox" class="f-cat" value="Furniture" checked> Furniture</label>
            <label><input type="checkbox" class="f-cat" value="Health" checked> Health</label>
            <label><input type="checkbox" class="f-cat" value="Storage" checked> Storage</label>
          </div>
        </div>
        <div class="group">
          <strong>Price (₹)</strong>
          <input id="priceMin" type="number" min="0" value="0" aria-label="Min price"/>
          <input id="priceMax" type="number" min="0" value="200000" aria-label="Max price"/>
        </div>
        <div class="group">
          <strong>Rating</strong>
          <select id="ratingMin">
            <option value="0">All ratings</option>
            <option value="3">3★ & up</option>
            <option value="4">4★ & up</option>
            <option value="4.5">4.5★ & up</option>
          </select>
        </div>
        <div class="group">
          <strong>Sort by</strong>
          <select id="sortBy" aria-label="Sort products">
            <option value="pop">Most popular</option>
            <option value="priceAsc">Price: Low to High</option>
            <option value="priceDesc">Price: High to Low</option>
            <option value="new">Newest</option>
            <option value="rating">Top rated</option>
          </select>
        </div>
        <button class="btn" id="btnApplyFilters">Apply filters</button>
        <button class="btn ghost" id="btnResetFilters">Reset</button>
      </aside>

      <!-- Products -->
      <div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
          <h2>Catalog</h2>
          <span id="resultsCount" class="tag">0 items</span>
        </div>
        <div class="grid product-grid" id="productGrid" aria-live="polite"></div>
        <div id="pagination" style="display:flex; gap:8px; justify-content:center; margin-top:14px"></div>
      </div>
    </div>
  </section>

  <!-- Product Modal -->
  <div class="overlay" id="productOverlay" role="dialog" aria-modal="true" aria-labelledby="productTitle">
    <div class="modal">
      <header>
        <strong id="productTitle">Product</strong>
        <button class="icon-btn" id="closeProduct">✕</button>
      </header>
      <div class="body">
        <div>
          <img id="productImage" alt="Product preview" />
        </div>
        <div>
          <h3 id="productName">Name</h3>
          <div class="stars" id="productStars">★★★★★</div>
          <p id="productDesc" style="color:var(--muted)"></p>
          <div class="price">
            <strong id="productPrice">₹0</strong>
            <del id="productMRP" class="hidden">₹0</del>
            <span id="productTag" class="tag hidden"></span>
          </div>
          <div style="display:flex; gap:8px; margin-top:10px">
            <button class="btn" id="btnModalAdd">Add to Cart</button>
            <button class="btn secondary" id="btnBuyNow">Buy Now</button>
            <button class="icon-btn wish" id="btnModalWish" aria-label="Add to wishlist"></button>
          </div>
          <hr style="border-color:var(--border); margin:12px 0"/>
          <div>
            <h4>Reviews</h4>
            <div id="reviewsList" class="grid" style="gap:8px"></div>
            <form id="reviewForm" style="margin-top:8px">
              <div class="grid" style="grid-template-columns:1fr auto; gap:8px">
                <input id="revName" placeholder="Your name" required/>
                <div class="stars-input" id="revStars" aria-label="Rating">
                  <button type="button" data-s=1>★</button>
                  <button type="button" data-s=2>★</button>
                  <button type="button" data-s=3>★</button>
                  <button type="button" data-s=4>★</button>
                  <button type="button" data-s=5>★</button>
                </div>
              </div>
              <textarea id="revText" rows="2" placeholder="Share your experience…" required></textarea>
              <button class="btn" type="submit">Submit Review</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Floating Button (mobile aid) -->
  <div class="cart">
    <button class="btn" id="btnCartFloat">🛒 Cart</button>
    
  </div>

  <!-- Cart Panel -->
  <aside class="cart-panel" id="cartPanel" aria-label="Shopping cart" aria-live="polite">
    <div class="cart-head">
      <strong>Shopping Cart</strong>
      <button class="icon-btn" id="closeCart">✕</button>
    </div>
    <div class="cart-items" id="cartItems"></div>
    <div class="cart-foot">
      <div style="display:flex; justify-content:space-between"><span>Subtotal</span> <strong id="cartSubtotal">₹0</strong></div>
      <button class="btn" id="btnCheckout">Proceed to checkout</button>
    </div>
  </aside>

  <!-- Checkout -->
  <section class="checkout" id="checkout">
    <div class="container">
      <h2>Checkout</h2>
      <div class="grid checkout-grid">
        <form id="checkoutForm" class="card" style="padding:16px">
          <h3>Shipping Address</h3>
          <div class="field"><label for="fullName">Full name</label><input id="fullName" required /></div>
          <div class="field"><label for="address">Address</label><textarea id="address" rows="2" required></textarea></div>
          <div class="grid" style="grid-template-columns:2fr 1fr 1fr; gap:12px">
            <div class="field"><label for="city">City</label><input id="city" required /></div>
            <div class="field"><label for="state">State</label><input id="state" required /></div>
            <div class="field"><label for="pincode">Pincode</label><input id="pincode" required pattern="\\d{6}" /></div>
          </div>
          <h3>Shipping Method</h3>
          <div class="field">
            <select id="shippingMethod">
              <option value="standard">Standard — Free</option>
              <option value="express">Express — ₹149</option>
            </select>
          </div>
          <h3>Payment</h3>
          <div class="field">
            <select id="paymentMethod">
              <option value="cod">Cash on Delivery</option>
              <option value="card">Card (mock)</option>
              <option value="upi">UPI (mock)</option>
            </select>
          </div>
          <button class="btn" type="submit">Place Order</button>
        </form>
        <div class="card" style="padding:16px">
          <h3>Order Summary</h3>
          <div id="summaryItems" class="grid" style="gap:10px"></div>
          <div class="coupon" style="margin:10px 0">
            <input id="couponCode" placeholder="Coupon code (SAVE10, FREESHIP, NEWUSER)" />
            <button class="btn" id="applyCoupon" type="button">Apply</button>
          </div>
          <hr style="border-color:var(--border)"/>
          <div style="display:grid; gap:6px">
            <div style="display:flex; justify-content:space-between"><span>Subtotal</span><strong id="sumSubtotal">₹0</strong></div>
            <div style="display:flex; justify-content:space-between"><span>Discount</span><strong id="sumDiscount">− ₹0</strong></div>
            <div style="display:flex; justify-content:space-between"><span>Shipping</span><strong id="sumShipping">₹0</strong></div>
            <div style="display:flex; justify-content:space-between"><span>Total</span><strong id="sumTotal">₹0</strong></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Auth Modals -->
  <div class="overlay" id="authOverlay" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="modal" style="max-width:680px">
      <header>
        <strong id="authTitle">Welcome back</strong>
        <button class="icon-btn" id="closeAuth">✕</button>
      </header>
      <div class="body">
        <div class="auth-grid">
          <form id="formSignIn" style="padding:8px">
            <h3>Sign In</h3>
            <div class="field"><label for="siEmail">Email</label><input id="siEmail" type="email" required/></div>
            <div class="field"><label for="siPass">Password</label><input id="siPass" type="password" required/></div>
            <button class="btn" type="submit">Sign In</button>
          </form>
          <form id="formSignUp" style="padding:8px">
            <h3>Create Account</h3>
            <div class="field"><label for="suName">Name</label><input id="suName" required/></div>
            <div class="field"><label for="suEmail">Email</label><input id="suEmail" type="email" required/></div>
            <div class="field"><label for="suPass">Password</label><input id="suPass" type="password" required minlength="6"/></div>
            <button class="btn" type="submit">Sign Up</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile / Orders -->
  <section class="section" id="account">
    <div class="container">
      <h2>My Account</h2>
      <div class="tabs">
        <button class="tab active" data-tab="orders">Orders</button>
        <button class="tab" data-tab="wishlist">Wishlist</button>
        <button class="tab" data-tab="addresses">Addresses</button>
      </div>
      <div id="tab-orders" class="card" style="padding:14px">
        <div id="ordersList" class="grid" style="gap:10px"></div>
      </div>
      <div id="tab-wishlist" class="card hidden" style="padding:14px"></div>
      <div id="tab-addresses" class="card hidden" style="padding:14px"><em>Use checkout to add a default address.</em></div>
    </div>
  </section>

  <!-- Admin Panel -->
  <section class="section" id="admin">
    <div class="container">
      <h2>Admin Panel</h2>
      <div class="grid" style="grid-template-columns:1fr 1fr">
        <form id="adminForm" class="card" style="padding:14px">
          <h3>Add / Edit Product</h3>
          <input type="hidden" id="adminId" />
          <div class="field"><label>Name</label><input id="adminName" required/></div>
          <div class="field"><label>Category</label><input id="adminCategory" required/></div>
          <div class="field"><label>Price (₹)</label><input id="adminPrice" type="number" min="0" required/></div>
          <div class="field"><label>MRP (₹)</label><input id="adminMrp" type="number" min="0"/></div>
          <div class="field"><label>Rating (0-5)</label><input id="adminRating" typ e="number" step="0.1" min="0" max="5"/></div>
          <div class="field"><label>Image URL</label><input id="adminImage"/></div>
          <div class="field"><label>Description</label><textarea id="adminDesc" rows="2"></textarea></div>
          <div class="field"><label>Popularity</label><input id="adminPop" type="number" min="0"/></div>
          <div style="display:flex; gap:8px">
            <button class="btn" type="submit">Save Product</button>
            <button class="btn ghost" type="button" id="adminReset">Reset</button>
          </div>
        </form>
        <div class="card" style="padding:14px; overflow:auto">
          <h3>Products</h3>
          <table>
            <thead><tr><th>Name</th><th>Cat</th><th>Price</th><th>Rating</th><th></th></tr></thead>
            <tbody id="adminTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container grid" style="grid-template-columns:2fr 1fr 1fr; gap:14px">
      <div>
        <div class="brand"><div class="logo"></div> ShopMate</div>
        <p style="color:var(--muted)">Your trusted marketplace for gadgets, fashion, and home essentials. © <span id="year"></span></p>
      </div>
      <div>
        <strong>Company</strong>
        <div class="grid" style="margin-top:8px">
          <a href="#">About</a>
          <a href="#">Careers</a>
          <a href="#">Contact</a>
        </div>
      </div>
      <div>
        <strong>Help</strong>
        <div class="grid" style="margin-top:8px">
          <a href="#">Shipping</a>
          <a href="#">Returns</a>
          <a href="#">Support</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // ---------- Utilities ----------
    const fmt = n => `₹${n.toLocaleString('en-IN')}`;
    const qs = (s, el=document) => el.querySelector(s);
    const qsa = (s, el=document) => [...el.querySelectorAll(s)];
    const store = {
      get(k, d){ try{ return JSON.parse(localStorage.getItem(k)) ?? d } catch{ return d } },
      set(k, v){ localStorage.setItem(k, JSON.stringify(v)) },
      del(k){ localStorage.removeItem(k) }
    };

    // ---------- Demo Data ----------
    
    const seedProducts = [
      {id:1, name:'Nimbus Headphones Pro', category:'Audio', price:7999, mrp:9999, rating:4.5, pop:95, img:'https://images.unsplash.com/photo-1518441373681-5eec2884b9c7?q=80&w=1200&auto=format&fit=crop', desc:'Wireless over‑ear ANC headphones with 40h battery.'},
      {id:2, name:'Pixelite X14 Laptop', category:'Laptops', price:62990, mrp:74990, rating:4.3, pop:88, img:'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop', desc:'14" ultrabook, Ryzen 7, 16GB RAM, 512GB SSD.'},
      {id:3, name:'Aurora S9 Smartphone', category:'Phones', price:45999, mrp:49999, rating:4.6, pop:97, img:'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop', desc:'6.5" AMOLED, 5G, 108MP camera, 5000mAh.'},
      {id:4, name:'Stride Smartwatch 2', category:'Wearables', price:6999, mrp:8999, rating:4.2, pop:76, img:'https://images.unsplash.com/photo-1518441902113-c1d3c7b8a3cf?q=80&w=1200&auto=format&fit=crop', desc:'AMOLED display, GPS, SpO2, 10‑day battery.'},
      {id:5, name:'Breeze Air Purifier', category:'Home', price:12999, mrp:15999, rating:4.1, pop:60, img:'https://images.unsplash.com/photo-1582582429416-0ef4a51d2f28?q=80&w=1200&auto=format&fit=crop', desc:'HEPA H13, 400 sq.ft coverage, quiet motor.'},
      {id:6, name:'Comfy Hoodie Classic', category:'Fashion', price:1499, mrp:2499, rating:4.4, pop:82, img:'https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=1200&auto=format&fit=crop', desc:'Unisex fleece hoodie, multiple colors.'},
      {id:7, name:'Studio Mic USB', category:'Audio', price:4999, mrp:6499, rating:4.0, pop:58, img:'https://images.unsplash.com/photo-1484704849700-f032a568e944?q=80&w=1200&auto=format&fit=crop', desc:'Plug‑and‑play condenser mic for streams and calls.'},
      {id:8, name:'Feather Laptop 15', category:'Laptops', price:82990, mrp:99990, rating:4.7, pop:91, img:'https://images.unsplash.com/photo-1484704849700-f032a568e944?q=80&w=1200&auto=format&fit=crop', desc:'15.6" OLED, i7, 32GB RAM, 1TB SSD.'},
      {id:9, name:'Glow Night Lamp', category:'Home', price:999, mrp:1499, rating:4.8, pop:70, img:'https://images.unsplash.com/photo-1533158307587-828f0a76b740?q=80&w=1200&auto=format&fit=crop', desc:'Warm ambient lamp with touch dimmer.'},
      {id:10, name:'Flexi Fitness Band', category:'Wearables', price:1999, mrp:2999, rating:3.9, pop:50, img:'https://images.unsplash.com/photo-1598970434795-0c54fe7c0642?q=80&w=1200&auto=format&fit=crop', desc:'Heart rate, sleep tracking, water resistant.'},
      {id:11, name:'Silk Path Scarf', category:'Fashion', price:899, mrp:1299, rating:4.6, pop:40, img:'https://images.unsplash.com/photo-1539533018447-63fcce2678e3?q=80&w=1200&auto=format&fit=crop', desc:'Soft silk scarf with elegant patterns.'},
      {id:12, name:'Mini Bluetooth Speaker', category:'Audio', price:1599, mrp:1999, rating:4.3, pop:72, img:'https://images.unsplash.com/photo-1546435770-a3e426bf472b?q=80&w=1200&auto=format&fit=crop', desc:'Pocket speaker with punchy bass, IPX5.'},
      {id:13, name:'Nova Pro 5G Phone', category:'Phones', price:34999, mrp:39999, rating:4.5, pop:85, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'6.7" FHD+, Snapdragon 888, 4500mAh.'},
      {id:14, name:'Urban Backpack', category:'Fashion', price:2499, mrp:3499, rating:4.2, pop:65, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'Stylish backpack with laptop compartment.'},
      {id:15, name:'Pro Gaming Mouse', category:'Accessories', price:1999, mrp:2999, rating:4.1, pop:55, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'Ergonomic design, RGB lighting, 16000 DPI.'},
      {id:16, name:'Smart LED Bulb', category:'Home', price:799, mrp:1299, rating:4.0, pop:48, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'Wi‑Fi enabled, 16M colors, voice control.'},
      {id:17, name:'Portable SSD 1TB', category:'Storage', price:6999, mrp:8999, rating:4.5, pop:85, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'Fast external SSD with USB‑C, shockproof.'},
      {id:18, name:'Smart Fitness Scale', category:'Health', price:2499, mrp:3499, rating:4.2, pop:68, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'Measures weight, BMI, body fat, syncs with app.'},
      {id:19, name:'Wireless Game Controller', category:'Gaming', price:1999, mrp:2999, rating:4.0, pop:55, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'Bluetooth controller for PC and consoles.'},
      {id:20, name:'Ergo Office Chair', category:'Furniture', price:8999, mrp:11999, rating:4.7, pop:92, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?q=80&w=1200&auto=format&fit=crop', desc:'Ergonomic chair with lumbar support.'}
    ];


    // ---------- State ----------
    let products = store.get('products', seedProducts);
    let cart = store.get('cart', []); // {id, qty}
    let orders = store.get('orders', []);
    let user = store.get('user', null);

    const state = {
      query: '',
      cats: new Set(['Audio','Laptops','Phones','Wearables','Home','Fashion','Accessories','Gaming','Furniture','Health','Storage']),
      price: [0, 200000],
      ratingMin: 0,
      sort: 'pop',
      page: 1,
      perPage: 6
    };

    let wishlist = store.get('wishlist', []); // [ids]
    let reviews = store.get('reviews', {}); // { [productId]: [{name, rating, text, date}] }
    let coupon = store.get('coupon', null); // { code, discount, freeShip }

    function toast(msg){ const t=qs('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2000); }

    function isWished(id){ return wishlist.includes(id); }
    function toggleWish(id){
      if(isWished(id)) wishlist = wishlist.filter(x=>x!==id);
      else wishlist.push(id);
      store.set('wishlist', wishlist);
      renderProducts(); renderWishlist();
      if(currentProduct && currentProduct.id===id){ qs('#btnModalWish').classList.toggle('active', isWished(id)); }
      toast(isWished(id)?'Added to wishlist':'Removed from wishlist');
    }

    function renderWishlist(){
      const wrap = qs('#tab-wishlist');
      if(!wishlist.length){ wrap.innerHTML = '<em>No items yet. Use the ♡ button to add products.</em>'; return; }
      const items = products.filter(p=>wishlist.includes(p.id));
      wrap.innerHTML = items.map(p=>\`
        <div class="card" style="padding:10px; display:grid; grid-template-columns:80px 1fr auto; gap:10px; align-items:center">
          <img src="\${p.img}" alt="\${p.name}" style="width:80px; height:80px; object-fit:cover; border-radius:10px"/>
          <div><strong>\${p.name}</strong><div class="tag">\${p.category}</div><div class="price">\${fmt(p.price)}</div></div>
          <div style="display:flex; gap:8px">
            <button class="btn" data-add="\${p.id}">Add to Cart</button>
            <button class="btn danger" data-unwish="\${p.id}">Remove</button>
          </div>
        </div>
      \`).join('');
      qsa('[data-unwish]').forEach(b=>b.onclick=()=>toggleWish(+b.dataset.unwish));
      qsa('#tab-wishlist [data-add]').forEach(b=>b.onclick=()=>addToCart(+b.dataset.add));
    }


    // ---------- Hero Carousel ----------
    const carouselImgs = [
      'https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1600&auto=format&fit=crop',
      'https://images.unsplash.com/photo-1472851294608-062f824d29cc?q=80&w=1600&auto=format&fit=crop',
      'https://images.unsplash.com/photo-1512499617640-c2f999098c01?q=80&w=1600&auto=format&fit=crop'
    ];
    (function initCarousel(){
      const car = qs('#heroCarousel');
      const img = car.querySelector('img');
      const dots = qs('.dots', car);
      let idx = 0;
      carouselImgs.forEach((_, i)=>{
        const d=document.createElement('button'); d.className='dot'+(i===0?' active':''); d.addEventListener('click',()=>{idx=i; swap()}); dots.appendChild(d);
      });
      function swap(){ img.src = carouselImgs[idx]; qsa('.dot', car).forEach((d,i)=>d.classList.toggle('active', i===idx)); }
      setInterval(()=>{ idx=(idx+1)%carouselImgs.length; swap(); }, 4000);
    })();

    // ---------- Rendering ----------
    function stars(r){
      const full = Math.round(r);
      return `<span aria-label="${r} out of 5 stars">${'★'.repeat(full)}${'☆'.repeat(5-full)}</span>`;
    }

    function filterAndSort(){
      let list = products.filter(p => state.cats.has(p.category)
        && p.price>=state.price[0] && p.price<=state.price[1]
        && p.rating>=state.ratingMin
        && p.name.toLowerCase().includes(state.query)
      );
      switch(state.sort){
        case 'priceAsc': list.sort((a,b)=>a.price-b.price); break;
        case 'priceDesc': list.sort((a,b)=>b.price-a.price); break;
        case 'new': list.sort((a,b)=>b.id-a.id); break;
        case 'rating': list.sort((a,b)=>b.rating-a.rating); break;
        default: list.sort((a,b)=>b.pop-a.pop);
      }
      return list;
    }

    function renderProducts(){
      const grid = qs('#productGrid');
      const pag = qs('#pagination');
      const list = filterAndSort();
      qs('#resultsCount').textContent = `${list.length} items`;

      // pagination
      const pages = Math.max(1, Math.ceil(list.length / state.perPage));
      if(state.page>pages) state.page = pages;
      const from = (state.page-1)*state.perPage;
      const pageItems = list.slice(from, from+state.perPage);

      grid.innerHTML = pageItems.map(p=>`
        <article class="card product" aria-labelledby="p-${p.id}-name">
          <div class="thumb"><img src="${p.img}" alt="${p.name}"/></div>
          <div class="meta">
            <div class="tag">${p.category}</div>
            <strong id="p-${p.id}-name">${p.name}</strong>
            <div class="stars">${stars(p.rating)}</div>
            <div class="price"><strong>${fmt(p.price)}</strong> ${p.mrp?`<del>${fmt(p.mrp)}</del>`:''}</div>
            <div class="controls">
              <button class="btn" data-add="${p.id}">Add to Cart</button>
              <button class="btn secondary" data-view="${p.id}">Quick View</button>
              <button class="icon-btn wish ${wishlist.includes(p.id)?'active':''}" data-wish="${p.id}" aria-label="Add to wishlist"></button>
            </div>
          </div>
        </article>
      `).join('');

      // bind buttons
      qsa('[data-add]').forEach(b=>b.onclick=()=>addToCart(+b.dataset.add));
      qsa('[data-view]').forEach(b=>b.onclick=()=>openProduct(+b.dataset.view));
      qsa('[data-wish]').forEach(b=>b.onclick=()=>toggleWish(+b.dataset.wish));

      // render pagination
      pag.innerHTML = '';
      for(let i=1;i<=pages;i++){
        const btn = document.createElement('button');
        btn.className = 'btn ' + (i===state.page?'':'ghost');
        btn.textContent = i; btn.onclick = ()=>{state.page=i; renderProducts()};
        pag.appendChild(btn);
      }
    }

    // ---------- Cart ----------
    function addToCart(id, qty=1){
      const item = cart.find(i=>i.id===id);
      if(item) item.qty += qty; else cart.push({id, qty});
      store.set('cart', cart);
      updateCartBadge();
      renderCart();
    }
    function removeFromCart(id){ cart = cart.filter(i=>i.id!==id); store.set('cart', cart); renderCart(); updateCartBadge(); }
    function setQty(id, qty){ const it = cart.find(i=>i.id===id); if(!it) return; it.qty = Math.max(1, qty); store.set('cart', cart); renderCart(); updateCartBadge(); }
    function cartItemsDetailed(){ return cart.map(i=>({ ...products.find(p=>p.id===i.id), qty:i.qty })) }
    function cartTotals(){ const items=cartItemsDetailed(); const subtotal = items.reduce((s,x)=>s+x.price*x.qty,0); return {items, subtotal} }
    function updateCartBadge(){ qs('#cartCount').textContent = cart.reduce((s,x)=>s+x.qty,0) }
    function renderCart(){
      const wrap = qs('#cartItems'); const {items, subtotal} = cartTotals();
      wrap.innerHTML = items.map(p=>`
        <div class="cart-item">
          <img src="${p.img}" alt="${p.name}" style="width:60px; height:60px; object-fit:cover; border-radius:8px"/>
          <div>
            <strong>${p.name}</strong>
            <div class="price">${fmt(p.price)} × <div class="qty"><button class="icon-btn" data-dec="${p.id}">−</button><span>${p.qty}</span><button class="icon-btn" data-inc="${p.id}">+</button></div></div>
          </div>
          <button class="btn danger" data-remove="${p.id}">Remove</button>
        </div>
      `).join('') || '<em style="color:var(--muted)">Your cart is empty.</em>';
      qs('#cartSubtotal').textContent = fmt(subtotal);

      qsa('[data-remove]').forEach(b=>b.onclick=()=>removeFromCart(+b.dataset.remove));
      qsa('[data-inc]').forEach(b=>b.onclick=()=>setQty(+b.dataset.inc, (cart.find(i=>i.id===+b.dataset.inc).qty+1)));
      qsa('[data-dec]').forEach(b=>b.onclick=()=>setQty(+b.dataset.dec, (cart.find(i=>i.id===+b.dataset.dec).qty-1)));

      // Checkout summary side
      const sumWrap = qs('#summaryItems');
      sumWrap.innerHTML = cartItemsDetailed().map(p=>`<div style="display:flex; justify-content:space-between"><span>${p.name} × ${p.qty}</span><strong>${fmt(p.price*p.qty)}</strong></div>`).join('');
      qs('#sumSubtotal').textContent = fmt(subtotal);
      let ship = qs('#shippingMethod').value==='express' ? 149 : 0;
      if(coupon && coupon.freeShip) ship = 0;
      const discount = computeDiscount(subtotal);
      qs('#sumShipping').textContent = fmt(ship);
      qs('#sumDiscount').textContent = '− ' + fmt(discount);
      qs('#sumTotal').textContent = fmt(Math.max(0, subtotal - discount + ship));
    }

    // ---------- Product Modal ----------

    // Reviews
    let reviewStars = 5;
    function renderReviews(pid){
      const list = (reviews[pid]||[]);
      const wrap = qs('#reviewsList');
      wrap.innerHTML = list.length? list.map(r=>\`
        <div class="review">
          <div class="stars">\${'★'.repeat(r.rating)}\${'☆'.repeat(5-r.rating)}</div>
          <div style="color:var(--muted); font-size:.9rem">\${new Date(r.date).toLocaleString()}</div>
          <strong>\${r.name}</strong>
          <div>\${r.text}</div>
        </div>\`
      ).join('') : '<em style="color:var(--muted)">No reviews yet. Be the first!</em>';
    }

    function bindReviewForm(pid){
      reviewStars = 5;
      qsa('#revStars button').forEach(btn=>{
        btn.onclick = ()=>{ reviewStars = +btn.dataset.s; };
      });
      qs('#reviewForm').onsubmit = (e)=>{
        e.preventDefault();
        const entry = {name: qs('#revName').value.trim()||'Guest', rating: reviewStars, text: qs('#revText').value.trim(), date: new Date().toISOString()};
        if(!reviews[pid]) reviews[pid]=[];
        reviews[pid].unshift(entry);
        store.set('reviews', reviews);
        qs('#reviewForm').reset();
        reviewStars = 5;
        renderReviews(pid);
        toast('Thanks for your review!');
      };
    }

    // Theme
    function applyTheme(th){ document.body.setAttribute('data-theme', th); }
    function toggleTheme(){ const th = (localStorage.getItem('theme')||'dark')==='dark'?'light':'dark'; localStorage.setItem('theme', th); applyTheme(th); }
    const savedTheme = localStorage.getItem('theme')||'dark';
    applyTheme(savedTheme);
    qs('#btnTheme').onclick = toggleTheme;

    // Coupon handling
    function computeDiscount(subtotal){
      if(!coupon) return 0;
      if(coupon.code==='SAVE10') return Math.round(subtotal*0.10);
      if(coupon.code==='NEWUSER' && orders.length===0) return 250;
      return coupon.discount||0;
    }

    function applyCoupon(){
      const code = (qs('#couponCode').value||'').trim().toUpperCase();
      if(!code){ coupon=null; store.set('coupon', coupon); renderCart(); toast('Coupon cleared'); return; }
      if(['SAVE10','FREESHIP','NEWUSER'].includes(code)){
        coupon = { code, freeShip: code==='FREESHIP' };
        store.set('coupon', coupon);
        renderCart(); toast('Coupon applied');
      } else { toast('Invalid coupon'); }
    }
    qs('#applyCoupon').onclick = applyCoupon;

    let currentProduct = null;
    function openProduct(id){
      const p = products.find(x=>x.id===id); if(!p) return;
      currentProduct = p;
      qs('#productTitle').textContent = p.name;
      qs('#productName').textContent = p.name;
      qs('#productDesc').textContent = p.desc;
      qs('#productImage').src = p.img;
      qs('#productStars').innerHTML = stars(p.rating);
      qs('#productPrice').textContent = fmt(p.price);
      const mrp = qs('#productMRP');
      if(p.mrp && p.mrp>p.price){ mrp.classList.remove('hidden'); mrp.textContent = fmt(p.mrp); qs('#productTag').classList.remove('hidden'); qs('#productTag').textContent = `${Math.round(100 - (p.price/p.mrp)*100)}% off`; }
      else { mrp.classList.add('hidden'); qs('#productTag').classList.add('hidden'); }
      const mw = qs('#btnModalWish'); if(mw){ mw.classList.toggle('active', isWished(p.id)); mw.onclick = ()=>toggleWish(p.id); }
      renderReviews(p.id); bindReviewForm(p.id);
      qs('#productOverlay').classList.add('active');
    }

    // ---------- Checkout / Orders ----------
    function placeOrder(evt){
      evt.preventDefault();
      if(cart.length===0){ alert('Your cart is empty.'); return; }
      let ship = qs('#shippingMethod').value==='express' ? 149 : 0;
      if(coupon && coupon.freeShip) ship = 0;
      const {subtotal} = cartTotals();
      const total = Math.max(0, subtotal - computeDiscount(subtotal) + ship);
      const order = {
        id: Date.now(),
        items: cartItemsDetailed(),
        total, ship,
        address: {
          name: qs('#fullName').value, address: qs('#address').value, city: qs('#city').value, state: qs('#state').value, pincode: qs('#pincode').value
        },
        payment: qs('#paymentMethod').value,
        status: 'Processing',
        createdAt: new Date().toISOString()
      };
      orders.unshift(order); store.set('orders', orders);
      cart = []; store.set('cart', cart); updateCartBadge(); renderCart(); renderOrders();
      coupon = null; store.set('coupon', coupon);
      alert(`Order placed! #${order.id}`);
      location.hash = '#account';
    }

    function renderOrders(){
      const list = qs('#ordersList');
      if(!orders.length){ list.innerHTML = '<em style="color:var(--muted)">No orders yet.</em>'; return; }
      list.innerHTML = orders.map(o=>`
        <div class="card" style="padding:10px">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <strong>Order #${o.id}</strong>
            <span class="tag">${o.status}</span>
          </div>
          <div style="color:var(--muted)">${new Date(o.createdAt).toLocaleString()}</div>
          <div class="grid" style="grid-template-columns:1fr auto; gap:6px; margin-top:6px">
            <div>
              ${o.items.map(i=>`<div style="display:flex; justify-content:space-between"><span>${i.name} × ${i.qty}</span><span>${fmt(i.price*i.qty)}</span></div>`).join('')}
            </div>
            <div><strong>Total: ${fmt(o.total)}</strong></div>
          </div>
        </div>
      `).join('');
    }

    // ---------- Auth (Mock) ----------
    function signIn(e){ e.preventDefault(); user = {email: qs('#siEmail').value}; store.set('user', user); alert('Signed in!'); qs('#authOverlay').classList.remove('active'); }
    function signUp(e){ e.preventDefault(); user = {name: qs('#suName').value, email: qs('#suEmail').value}; store.set('user', user); alert('Account created!'); qs('#authOverlay').classList.remove('active'); }

    // ---------- Admin ----------
    function adminResetForm(){ qsa('#adminForm input, #adminForm textarea').forEach(i=>{ if(i.type!=='hidden') i.value=''; }); qs('#adminId').value=''; }
    function adminRender(){
      const tbody = qs('#adminTable');
      tbody.innerHTML = products.map(p=>`
        <tr>
          <td>${p.name}</td><td>${p.category}</td><td>${fmt(p.price)}</td><td>${p.rating}</td>
          <td style="display:flex; gap:6px; justify-content:end">
            <button class="btn ghost" data-edit="${p.id}">Edit</button>
            <button class="btn danger" data-del="${p.id}">Delete</button>
          </td>
        </tr>
      `).join('');
      qsa('[data-edit]').forEach(b=>b.onclick=()=>adminEdit(+b.dataset.edit));
      qsa('[data-del]').forEach(b=>b.onclick=()=>adminDelete(+b.dataset.del));
    }
    function adminEdit(id){
      const p = products.find(x=>x.id===id); if(!p) return;
      qs('#adminId').value = p.id;
      qs('#adminName').value = p.name;
      qs('#adminCategory').value = p.category;
      qs('#adminPrice').value = p.price;
      qs('#adminMrp').value = p.mrp||'';
      qs('#adminRating').value = p.rating;
      qs('#adminImage').value = p.img;
      qs('#adminDesc').value = p.desc||'';
      qs('#adminPop').value = p.pop||0;
      window.scrollTo({top: qs('#admin').offsetTop - 60, behavior:'smooth'});
    }
    function adminDelete(id){ products = products.filter(p=>p.id!==id); store.set('products', products); adminRender(); renderProducts(); }
    function adminSave(e){
      e.preventDefault();
      const idv = qs('#adminId').value;
      const payload = {
        id: idv? +idv : (Math.max(...products.map(p=>p.id))+1),
        name: qs('#adminName').value,
        category: qs('#adminCategory').value,
        price: +qs('#adminPrice').value,
        mrp: +qs('#adminMrp').value || null,
        rating: +qs('#adminRating').value || 0,
        img: qs('#adminImage').value || 'https://picsum.photos/seed/p'+Math.random().toString(36).slice(2,7)+'/800/600',
        desc: qs('#adminDesc').value,
        pop: +qs('#adminPop').value || 0
      };
      const idx = products.findIndex(p=>p.id===payload.id);
      if(idx>-1) products[idx]=payload; else products.push(payload);
      store.set('products', products);
      adminResetForm(); adminRender(); renderProducts();
    }

    // ---------- Events & Init ----------
    function applyFilters(){
      state.query = qs('#searchInput').value.trim().toLowerCase();
      state.price = [ +qs('#priceMin').value || 0, +qs('#priceMax').value || 200000 ];
      state.ratingMin = +qs('#ratingMin').value || 0;
      state.sort = qs('#sortBy').value;
      state.cats = new Set(qsa('.f-cat').filter(c=>c.checked).map(c=>c.value));
      state.page = 1; renderProducts();
    }

    // Topbar auth buttons
    qs('#btnSignIn').onclick = ()=> qs('#authOverlay').classList.add('active');
    qs('#btnSignUp').onclick = ()=> qs('#authOverlay').classList.add('active');
    qs('#closeAuth').onclick = ()=> qs('#authOverlay').classList.remove('active');

    // Search
    qs('#btnSearch').onclick = applyFilters;
    qs('#searchInput').addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); applyFilters(); } });

    // Category chips click
    qsa('.cat').forEach(c=> c.onclick = ()=>{ qsa('.f-cat').forEach(cb=>{ cb.checked = cb.value===c.dataset.cat; }); applyFilters(); location.hash = '#catalog'; });

    // Filter buttons
    qs('#btnApplyFilters').onclick = applyFilters;
    qs('#btnResetFilters').onclick = ()=>{ qsa('.f-cat').forEach(c=>c.checked=true); qs('#priceMin').value=0; qs('#priceMax').value=200000; qs('#ratingMin').value=0; qs('#sortBy').value='pop'; applyFilters(); };

    // Product modal buttons
    qs('#closeProduct').onclick = ()=> qs('#productOverlay').classList.remove('active');
    qs('#btnModalAdd').onclick = ()=>{ if(!currentProduct) return; addToCart(currentProduct.id); alert('Added to cart!'); };
    qs('#btnBuyNow').onclick = ()=>{ if(!currentProduct) return; addToCart(currentProduct.id); qs('#productOverlay').classList.remove('active'); openCart(); };

    // Cart panel
    function openCart(){ qs('#cartPanel').classList.add('active'); }
    function closeCart(){ qs('#cartPanel').classList.remove('active'); }
    qs('#btnOpenCart').onclick = openCart;
    qs('#btnCartFloat').onclick = openCart;
    qs('#closeCart').onclick = closeCart;

    // Checkout
    qs('#shippingMethod').onchange = renderCart;
    qs('#checkoutForm').onsubmit = placeOrder;

    // Auth submit
    qs('#formSignIn').onsubmit = signIn;
    qs('#formSignUp').onsubmit = signUp;

    // Tabs
    qsa('.tab').forEach(t=> t.onclick = ()=>{
      qsa('.tab').forEach(x=>x.classList.remove('active')); t.classList.add('active');
      ['orders','wishlist','addresses'].forEach(id=> qs('#tab-'+id).classList.add('hidden'));
      qs('#tab-'+t.dataset.tab).classList.remove('hidden');
      if(t.dataset.tab==='wishlist') renderWishlist();
    });

    // Admin
    qs('#adminForm').onsubmit = adminSave;
    qs('#adminReset').onclick = adminResetForm;

    // Close modals on overlay click
    qsa('.overlay').forEach(ov=> ov.addEventListener('click', e=>{ if(e.target===ov) ov.classList.remove('active') }));

    // Init
    (function init(){
      qs('#year').textContent = new Date().getFullYear();
      renderProducts(); updateCartBadge(); renderCart(); renderOrders(); adminRender(); renderWishlist();
    })();
  </script>
  
  <div class="toast" id="toast"></div>
</body>
</html>

